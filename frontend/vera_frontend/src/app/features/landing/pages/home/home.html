<!-- ÉTAT INITIAL : Landing page (avant le premier message) -->
@if (messages.length === 0) {
  <main role="main" aria-label="Page d'accueil Vera">
    <!-- Hero Section -->
    <section class="relative px-8 pt-4 pb-2" aria-labelledby="hero-title">
      <div class="max-w-[1800px] mx-auto">
        <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-8">
          <!-- Contenu gauche -->
          <div class="flex-1 lg:max-w-[58%] xl:max-w-[60%]">
            <!-- Titre + Image mobile -->
            <div class="flex items-start justify-between gap-2 mb-6">
              <h1 id="hero-title" class="big-title text-3xl lg:text-5xl text-stone-900">
                Vérification <span class="bg-primary-green-200 px-2 rounded">instantanée</span>
              </h1>

              <!-- Image mobile (visible uniquement sur mobile) - décorative -->
              <div class="relative lg:hidden shrink-0" aria-hidden="true">
                <svg
                  class="w-28 h-32"
                  viewBox="0 0 102 110"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  aria-hidden="true"
                  focusable="false"
                >
                  <defs>
                    <clipPath id="circleClipMobile">
                      <circle cx="42" cy="42" r="42" />
                    </clipPath>
                  </defs>
                  <g clip-path="url(#circleClipMobile)">
                    <circle cx="42" cy="42" r="42" fill="#1F1C19" />
                    <image
                      href="assets/images/big-logo.png"
                      x="-5"
                      y="-5"
                      width="94"
                      height="94"
                      preserveAspectRatio="xMidYMid slice"
                    />
                  </g>
                  <path
                    d="M63.4594 87.1569C62.548 87.151 62.5927 89.2412 63.622 96.0648C64.7163 103.287 65.2208 104.841 66.2512 104.475C67.662 103.955 64.9331 87.2044 63.4594 87.1569Z"
                    fill="black"
                  />
                  <path
                    d="M94.8913 79.7774C94.7145 77.0586 94.2252 76.7393 88.1354 75.3528C81.8469 73.9142 80.647 73.8749 80.2796 75.0298C79.622 77.1265 81.1651 78.0406 88.8545 80.2075C94.5285 81.803 95.022 81.784 94.8913 79.7774Z"
                    fill="black"
                  />
                  <path
                    d="M86.5109 95.4137C86.4098 93.4571 85.9747 92.7703 83.505 90.6162C76.1546 84.2541 71.4093 79.1271 71.6827 82.9316C71.7837 84.4851 73.028 85.8087 81.3782 93.5361C86.0145 97.786 86.6291 98.0322 86.5109 95.4137Z"
                    fill="black"
                  />
                </svg>
              </div>
            </div>

            <!-- Sous-titres -->
            <p class="text-lg text-stone-700 font-medium mb-2">Quelle info veux-tu vérifier ?</p>
            <p class="text-stone-600 mb-8">
              Posez une question à Vera par le moyen le plus adapté, elle est réactive et accessible
            </p>

            <!-- Input -->
            <div
              class="mb-8 [&>div]:mx-0 [&>div]:px-0 [&>div]:shadow-[0_4px_20px_rgba(0,0,0,0.12)] rounded-2xl w-full"
            >
              <app-input
                [suggestions]="suggestions"
                [showSuggestions]="showSuggestions"
                (messageSent)="onMessage($event)"
                (suggestionClicked)="onSuggestion($event)"
                (inputFocused)="onInputFocus()"
                (inputBlurred)="onInputBlur()"
                aria-label="Zone de saisie pour poser une question à Vera"
              >
              </app-input>
            </div>
          </div>

          <!-- Image desktop (visible uniquement sur desktop) - décorative -->
          <div
            class="hidden lg:flex items-start justify-center relative shrink-0 -translate-x-1/3 -translate-y-8 lg:-translate-x-1/4 2xl:-translate-x-60"
            aria-hidden="true"
          >
            <!-- Flèche pointillée - décorative -->
            <svg
              class="absolute top-0 lg:-left-35 lg:w-40 lg:h-30 xl:-left-50 xl:w-60 xl:h-38 2xl:-left-65 2xl:-top-8 2xl:w-90 2xl:h-46"
              viewBox="0 0 199 192"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              focusable="false"
            >
              <g clip-path="url(#clip0_arrow)">
                <path
                  d="M96.1728 98.3988C109.915 97.1913 110.8 96.6271 110.811 97.4268C110.846 100.01 108.121 101.027 98.1032 102.252C92.2032 102.967 90.7555 102.892 90.6193 101.94C90.3149 99.9444 92.1762 98.7535 96.1728 98.3988Z"
                  fill="black"
                />
                <path
                  d="M136.456 93.3414C136.771 93.8605 135.929 95.2855 134.952 95.8817C133.609 96.6975 118.278 98.7848 117.932 98.2044C117.554 97.6244 118.089 96.2338 119.122 95.2372C120.458 93.8988 135.764 92.2422 136.456 93.3414Z"
                  fill="black"
                />
                <path
                  d="M19.5454 86.1335C21.6853 87.3081 24.786 88.9634 26.4284 89.7747C29.7131 91.3666 30.0271 91.8243 28.751 93.039C26.4724 95.219 12.4234 89.7859 12.3813 86.7101C12.3708 83.6955 14.8 83.513 19.5454 86.1335Z"
                  fill="black"
                />
                <path
                  d="M160.078 92.048C161.901 92.6107 162.115 92.4543 164.739 88.4864C168.658 82.5335 171.288 85.7944 171.295 86.3171C171.322 88.2241 179.223 98.8055 183.65 102.845C187.857 106.671 185.85 108.418 178.813 107.055C168.166 104.996 155.344 106.008 154.116 106.177C150.581 106.587 150.697 106.063 155.301 100.656C158.119 97.362 158.537 96.4647 157.424 96.0477C156.032 95.5409 149.838 94.9986 146.329 95.0705C144.484 95.1232 138.708 95.929 142.475 92.3163C144.663 90.2601 153.802 90.0914 160.078 92.048Z"
                  fill="black"
                />
                <path
                  d="M74.2067 99.1806C84.8073 100.071 84.6529 100.042 82.9262 102.062C81.9869 103.15 76.2694 103.709 70.9684 103.218C64.0031 102.561 59.9441 102.855 62.3341 99.8124C63.4529 98.3534 64.1295 98.3147 74.2067 99.1806Z"
                  fill="black"
                />
                <path
                  d="M48.743 96.3725C56.1941 98.7766 56.442 98.8967 55.6237 99.8292C53.7442 101.943 38.1285 98.9891 38.0943 96.4977C38.0552 93.6373 40.179 93.6123 48.743 96.3725Z"
                  fill="black"
                />
              </g>
              <defs>
                <clipPath id="clip0_arrow">
                  <rect
                    width="154"
                    height="125"
                    fill="white"
                    transform="translate(73.7815) rotate(36.1748)"
                  />
                </clipPath>
              </defs>
            </svg>

            <!-- Cercle avec statue - décoratif -->
            <svg
              class="w-72 h-82 lg:w-72 lg:h-80 xl:w-75 xl:h-90 2xl:w-85 2xl:h-95"
              viewBox="0 0 102 110"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              focusable="false"
            >
              <defs>
                <clipPath id="circleClipDesktop">
                  <circle cx="42" cy="42" r="42" />
                </clipPath>
              </defs>
              <g clip-path="url(#circleClipDesktop)">
                <circle cx="42" cy="42" r="42" fill="#1F1C19" />
                <image
                  href="assets/images/big-logo.png"
                  x="-5"
                  y="-5"
                  width="94"
                  height="94"
                  preserveAspectRatio="xMidYMid slice"
                />
              </g>
              <path
                d="M63.4594 87.1569C62.548 87.151 62.5927 89.2412 63.622 96.0648C64.7163 103.287 65.2208 104.841 66.2512 104.475C67.662 103.955 64.9331 87.2044 63.4594 87.1569Z"
                fill="black"
              />
              <path
                d="M94.8913 79.7774C94.7145 77.0586 94.2252 76.7393 88.1354 75.3528C81.8469 73.9142 80.647 73.8749 80.2796 75.0298C79.622 77.1265 81.1651 78.0406 88.8545 80.2075C94.5285 81.803 95.022 81.784 94.8913 79.7774Z"
                fill="black"
              />
              <path
                d="M86.5109 95.4137C86.4098 93.4571 85.9747 92.7703 83.505 90.6162C76.1546 84.2541 71.4093 79.1271 71.6827 82.9316C71.7837 84.4851 73.028 85.8087 81.3782 93.5361C86.0145 97.786 86.6291 98.0322 86.5109 95.4137Z"
                fill="black"
              />
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Section Features -->
    <section class="px-6 lg:px-12 xl:px-16 2xl:px-24 pb-8 pt-1" aria-labelledby="features-title">
      <div class="max-w-[1800px] mx-auto">
        <!-- Titre section -->
        <h2 id="features-title" class="text-body-header text-stone-900 mb-8">
          Vera l'IA de
          <span class="bg-primary-green-200 decoration-2 underline-offset-4">fact-checking</span>
        </h2>

        <!-- Cartes -->
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
          role="list"
          aria-label="Fonctionnalités de Vera"
        >
          <!-- Carte 1: Résultat rapide -->
          <article
            class="bg-neutral-beige-50 rounded-2xl p-6 drop-shadow-[2px_2px_0px_#000000] flex flex-col"
            role="listitem"
          >
            <h3 class="title text-stone-900 mb-3 rounded-2xl">Un résultat en 3 secondes</h3>
            <p class="text-stone-600 text-body-paragraph flex-1">
              Une réponse claire et fiable en seulement 3 secondes.
            </p>
          </article>

          <!-- Carte 2: Sources fiables -->
          <article
            class="bg-neutral-beige-50 rounded-2xl p-6 drop-shadow-[2px_2px_0px_#000000] flex flex-col"
            role="listitem"
          >
            <h3 class="title text-stone-900 mb-3 rounded-2xl">Sources fiables</h3>
            <p class="text-stone-600 text-body-paragraph flex-1 mb-4">
              Vera est connectée en temps réel à 400+ sites de fact-checking.
            </p>
            <a
              href="https://occipital-error-b1f.notion.site/Les-sources-sur-lesquelles-s-appuie-Vera-140e6d47103780cdaedbd0a7a7d34dce"
            >
              <button
                type="button"
                class="w-full bg-stone-900 text-white py-3 px-4 rounded-full text-sm font-medium hover:bg-stone-800 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-900"
                aria-label="Voir la liste des 400 sources de fact-checking"
              >
                Voir la liste des sources
              </button>
            </a>
          </article>

          <!-- Carte 3: Gratuit -->
          <article
            class="bg-neutral-beige-50 rounded-2xl p-6 drop-shadow-[2px_2px_0px_#000000] flex flex-col"
            role="listitem"
          >
            <h3 class="title text-stone-900 mb-3 rounded-2xl">100% gratuit</h3>
            <p class="text-stone-600 text-body-paragraph flex-1 mb-4">
              LaReponse.tech, l'ONG derrière Vera est financée par ses membres, qui mettent à
              disposition leur temps, leurs compétences et leurs ressources.
            </p>
            <a
              href="https://occipital-error-b1f.notion.site/"
              target="_blank"
              rel="noopener noreferrer"
              class="w-full bg-stone-900 text-white py-3 px-4 rounded-full text-body-paragraph font-medium hover:bg-stone-800 transition-colors cursor-pointer text-center focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-900"
              aria-label="Découvrir LaReponse.tech - Ouvre dans un nouvel onglet"
            >
              Découvrir LaReponse.tech
              <span class="sr-only">(ouvre dans un nouvel onglet)</span>
            </a>
          </article>
        </div>
      </div>
    </section>
  </main>
} @else {
  <!-- ÉTAT CONVERSATION : Chat (après le premier message) -->
  <main
    role="main"
    aria-label="Conversation avec Vera"
    class="h-screen pt-16 flex flex-col overflow-hidden bg-cover bg-center bg-no-repeat"
    style="background-image: url('...')"
  >
    <!-- Bouton retour - positionné pour être accessible -->
    <button
      (click)="resetChat()"
      type="button"
      class="fixed top-20 left-4 p-2 bg-white rounded-full drop-shadow-[2px_2px_0px_#000000] hover:bg-stone-100 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-900 z-10"
      aria-label="Retourner à l'accueil et démarrer une nouvelle conversation"
    >
      <svg
        class="w-5 h-5 text-stone-600"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
        focusable="false"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 19l-7-7m0 0l7-7m-7 7h18"
        />
      </svg>
    </button>

    <!-- Zone des messages (scrollable, hauteur limitée) -->
    <div
      #messagesContainer
      class="overflow-y-auto px-4 py-6 scroll-smooth"
      style="height: calc(100vh - 300px)"
      role="log"
      aria-label="Historique de la conversation"
      aria-live="polite"
      aria-relevant="additions"
    >
      <div class="w-full max-w-3xl mx-auto">
        @for (message of messages; track message.id) {
          <app-chat-bubble [message]="message"></app-chat-bubble>
        }
      </div>
    </div>

    <!-- Input fixé en bas de l'écran -->
    <div class="shrink-0 py-4 border-t border-gray-300">
      <div class="w-full max-w-2xl mx-auto px-8">
        <app-input
          [suggestions]="[]"
          [showSuggestions]="false"
          (messageSent)="onMessage($event)"
          aria-label="Zone de saisie pour continuer la conversation"
        >
        </app-input>
      </div>
    </div>
  </main>
}
